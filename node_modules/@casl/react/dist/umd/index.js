!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("prop-types"),require("@casl/ability")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","@casl/ability"],e):e((t.casl=t.casl||{},t.casl.react={}),t.React,t.React.PropTypes,t.casl)}(this,function(t,n,i,r){"use strict";var e="default"in n?n.default:n;i=i&&i.hasOwnProperty("default")?i.default:i;var c=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),l=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u=function(){},o=i.oneOfType([i.object,i.string]).isRequired;function p(r,o){return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(!r.split(" ").some(function(t){return e[t]}))return o.apply(void 0,[e].concat(n))}}var f=function(r){function o(){c(this,o);for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=s(this,r.call.apply(r,[this].concat(e)));return i.unsubscribeFromAbility=u,i.state={ability:i.props.ability,allowed:!1},i}return l(o,r),o.prototype.componentWillReceiveProps=function(t){t.ability&&this.state.ability!==t.ability?(this.setState({ability:t.ability}),this.connectToAbility(t.ability)):this.recheck(t)},o.prototype.componentWillMount=function(){this.connectToAbility(this.state.ability)},o.prototype.componentWillUnmount=function(){this.unsubscribeFromAbility()},o.prototype.connectToAbility=function(t){var e=this;this.unsubscribeFromAbility(),t&&(this.unsubscribeFromAbility=t.on("updated",function(){return e.recheck()}),this.recheck())},o.prototype.recheck=function(t){return this.setState({allowed:this.check(t)})},o.prototype.check=function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null)||this.props,e=(t.I||t.do).split(/\s+/),n=e[0],i=e[1],r=t.of||t.a||t.this||t.on,o=t.not?"cannot":"can";return this.state.ability[o](n,r,i)},o.prototype.render=function(){return this.state.allowed?this.renderChildren():null},o.prototype.renderChildren=function(){var t=this.props.children;return"function"==typeof t?t(this.state.ability):e.Children.only(t)},a(o,[{key:"allowed",get:function(){return this.state.allowed}}]),o}(n.PureComponent);f.propTypes={I:p("do",i.string.isRequired),a:p("on this of",o),of:p("on a this",o),this:p("on a of",o),do:p("I",i.string.isRequired),on:p("this a of",o),not:i.bool,children:i.any.isRequired,ability:i.instanceOf(r.Ability).isRequired},t.Can=f,t.createCanBoundTo=function(a){var t,e;return e=t=function(r){function o(){c(this,o);for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=s(this,r.call.apply(r,[this].concat(e)));return i.state.ability=i.state.ability||a,i}return l(o,r),o}(f),t.propTypes=Object.assign({},f.propTypes,{ability:i.instanceOf(r.Ability)}),e},t.createContextualCan=function(t){return function(e){return n.createElement(t,null,function(t){return n.createElement(f,{ability:e.ability||t,I:e.I||e.do,a:e.a||e.of||e.this||e.on,not:e.not,children:e.children})})}},Object.defineProperty(t,"__esModule",{value:!0})});
